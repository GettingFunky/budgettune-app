<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Î£Ï…Î½Î±Î»Î»Î±Î³Î®Ï‚ | BudgetTune</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="d-flex flex-column min-vh-100 bg-light">

<!-- Header -->
<div th:replace="~{fragments/header :: header}"
></div>

<div class="flex-grow-1">
    <div class="container mt-5">
    <h2 class="mb-4">âœï¸ ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Î£Ï…Î½Î±Î»Î»Î±Î³Î®Ï‚</h2>

    <form th:action="@{${transactionDTO.id} == null ? '/transactions/create' : '/transactions/' + ${transactionDTO.id} + '/edit'}"
          th:object="${transactionDTO}" method="post" class="card p-4 shadow-sm">

        <input type="hidden" th:field="*{id}" />

        <div class="mb-3">
            <label for="description" class="form-label">Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label>
            <input type="text" id="description" th:field="*{description}" class="form-control" required>
            <div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
        </div>

        <div class="mb-3">
            <label for="amount" class="form-label">Î Î¿ÏƒÏŒ (â‚¬)</label>
            <input type="number" id="amount" th:field="*{amount}" step="0.01" min="0.01" max="1000000" class="form-control" required>
            <div class="text-danger" th:if="${#fields.hasErrors('amount')}" th:errors="*{amount}"></div>
        </div>


        <!-- ÎšÏÏ…Ï†ÏŒ input Ï€Î¿Ï… Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ ÏƒÏ„Î­Î»Î½ÎµÎ¹ Ï„Î·Î½ Ï„Î¹Î¼Î® -->
        <input type="hidden" id="categoryHidden" th:field="*{category}" />

        <div class="mb-3 d-flex flex-wrap align-items-end gap-3"> <!-- Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· flex container -->
            <div class="flex-grow-1"> <!-- Î¤Î¿ Ï€ÏÏÏ„Î¿ select Î½Î± Ï€Î±Î¯ÏÎ½ÎµÎ¹ Ï„Î¿Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï‡ÏÏÎ¿ -->
                <label for="category" class="form-label">ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</label>
                <select id="category" th:field="*{category}" class="form-select">
                    <option value="">-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ --</option>
                    <option th:value="Î¦Î±Î³Î·Ï„ÏŒ">ğŸ½ï¸ Î¦Î±Î³Î·Ï„ÏŒ</option>
                    <option th:value="ÎœÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚">ğŸš— ÎœÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚</option>
                    <option th:value="Î•Î½Î¿Î¯ÎºÎ¹Î¿">ğŸ  Î•Î½Î¿Î¯ÎºÎ¹Î¿</option>
                    <option th:value="Î”Î¹Î±ÏƒÎºÎ­Î´Î±ÏƒÎ·">ğŸ‰ Î”Î¹Î±ÏƒÎºÎ­Î´Î±ÏƒÎ·</option>
                    <option th:value="Î¥Î³ÎµÎ¯Î±">ğŸ¥ Î¥Î³ÎµÎ¯Î±</option>
                    <option th:value="ÎœÎ¹ÏƒÎ¸ÏŒÏ‚">ğŸ’¼ ÎœÎ¹ÏƒÎ¸ÏŒÏ‚</option>
                    <option th:value="Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚">ğŸ“ Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚</option>
                    <option th:value="Î”ÏÏÎ±">ğŸ Î”ÏÏÎ±</option>
                    <option th:value="__custom__">âœ¨ Î†Î»Î»Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±...</option>
                </select>
            </div>

            <div id="customCategoryDiv" style="display:none; flex-basis: 0; flex-grow: 1;"> <!-- Î™ÏƒÎ¿Î¼ÎµÏÎ®Ï‚ ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Ï‡ÏÏÎ¿Ï… -->
                <label for="customCategory" class="form-label">âœï¸ Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±:</label>
                <input type="text" id="customCategory" class="form-control" />
            </div>
        </div>



        <div class="mb-3">
            <label for="date" class="form-label">ğŸ“… Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
            <input type="date" id="date" name="date" th:value="${transactionDTO.date != null ? transactionDTO.date : ''}"
                   class="form-control" required>
            <div class="text-danger" th:if="${#fields.hasErrors('date')}" th:errors="*{date}"></div>
        </div>

        <div class="mb-3">
            <label for="type" class="form-label">ğŸ”˜ Î¤ÏÏ€Î¿Ï‚ Î£Ï…Î½Î±Î»Î»Î±Î³Î®Ï‚</label>
            <select id="type" th:field="*{type}" class="form-select" required>
                <option value="" selected>-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„ÏÏ€Î¿ --</option>
                <option th:value="INCOME">ğŸ’° ÎˆÏƒÎ¿Î´Î¿</option>
                <option th:value="EXPENSE">ğŸ’¸ ÎˆÎ¾Î¿Î´Î¿</option>
            </select>
            <div class="text-danger" th:if="${#fields.hasErrors('type')}" th:errors="*{type}"></div>
        </div>

        <div class="mb-3">
            <label for="notes" class="form-label">ğŸ“ Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</label>
            <input type="text" id="notes" th:field="*{notes}" class="form-control">
            <div class="text-danger" th:if="${#fields.hasErrors('notes')}" th:errors="*{notes}"></div>
        </div>

        <div class="mb-3">
            <label for="means" class="form-label">ğŸ’³ Î Î·Î³Î®</label>
            <select id="means" th:field="*{means}" class="form-select">
                <option value="" selected hidden>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„ÏÏ€Î¿...</option>
                <option th:value="CASH">ğŸ’µ ÎœÎµÏ„ÏÎ·Ï„Î¬</option>
                <option th:value="CARD">ğŸ’³ ÎšÎ¬ÏÏ„Î±</option>
                <option th:value="OTHER">â“ Î†Î»Î»Î¿</option>
            </select>
            <div class="text-danger" th:if="${#fields.hasErrors('means')}" th:errors="*{means}"></div>
        </div>

        <div class="btn-group-vertical w-100 text-center" style="max-width: 300px; margin: 0 auto;">
            <button type="submit" class="btn btn-success btn-lg py-3 mb-2" style="background-color: #41807E; color: white;"
                    title="Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎºÎ±Î¹ Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÏ„Î· Î›Î¯ÏƒÏ„Î± Î£Ï…Î½Î±Î»Î»Î±Î³ÏÎ½">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
            <a th:href="@{/dashboard}" class="btn btn-secondary btn-lg py-3" title="Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ dashboard Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·">âœ–ï¸ Î‘ÎºÏÏÏ‰ÏƒÎ·</a>
        </div>

    </form>
</div>
</div>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"
></div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const categorySelect = document.getElementById('category');
        const customCategoryDiv = document.getElementById('customCategoryDiv');
        const customCategoryInput = document.getElementById('customCategory');
        const categoryHidden = document.getElementById('categoryHidden');
        const form = document.querySelector('form');

        categorySelect.addEventListener('change', function () {
            if (this.value === '__custom__') {
                customCategoryDiv.style.display = 'block';
                categoryHidden.value = ''; // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬
            } else {
                customCategoryDiv.style.display = 'none';
                categoryHidden.value = this.value; // Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î¿Ï…Î¼Îµ Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±
            }
        });

        form.addEventListener('submit', function (e) {
            if (categorySelect.value === '__custom__') {
                if (customCategoryInput.value.trim() === '') {
                    e.preventDefault();
                    alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±.");
                    customCategoryInput.focus();
                    return;
                }
                categoryHidden.value = customCategoryInput.value.trim(); // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï„Î¿ custom
            }
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>`